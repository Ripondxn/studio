{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/license.ts"],"sourcesContent":["\n'use server';\n\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport { differenceInDays, addDays, format, parseISO } from 'date-fns';\n\nconst licenseFilePath = path.join(process.cwd(), 'license.json');\nconst TRIAL_PERIOD_DAYS = 30;\n\ntype LicenseInfo = {\n    trialStartDate: string;\n};\n\nexport type LicenseStatus = {\n    isActive: boolean;\n    isTrial: boolean;\n    daysRemaining: number;\n    expiryDate: string;\n};\n\nasync function readLicenseFile(): Promise<LicenseInfo | null> {\n    try {\n        await fs.access(licenseFilePath);\n        const data = await fs.readFile(licenseFilePath, 'utf-8');\n        // Basic validation in case the file is empty or corrupted\n        if (!data) return null;\n        return JSON.parse(data);\n    } catch (error) {\n        return null; // File doesn't exist or is unreadable\n    }\n}\n\nasync function createLicenseFile(): Promise<LicenseInfo> {\n    const trialStartDate = new Date().toISOString();\n    const newLicense: LicenseInfo = { trialStartDate };\n    await fs.writeFile(licenseFilePath, JSON.stringify(newLicense, null, 2), 'utf-8');\n    return newLicense;\n}\n\nexport async function checkLicenseStatus(): Promise<LicenseStatus> {\n    let license = await readLicenseFile();\n\n    if (!license) {\n        license = await createLicenseFile();\n    }\n    \n    const startDate = parseISO(license.trialStartDate);\n    const now = new Date();\n    const expiryDate = addDays(startDate, TRIAL_PERIOD_DAYS);\n    const daysRemaining = differenceInDays(expiryDate, now);\n\n    const isActive = daysRemaining >= 0;\n\n    return {\n        isActive,\n        isTrial: true, // For now, we only have a trial license\n        daysRemaining: Math.max(0, daysRemaining),\n        expiryDate: format(expiryDate, 'PPP'),\n    };\n}\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AAAA;AAAA;AAAA;;;;;;AAEA,MAAM,kBAAkB,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACjD,MAAM,oBAAoB;AAa1B,eAAe;IACX,IAAI;QACA,MAAM,yGAAE,CAAC,MAAM,CAAC;QAChB,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,iBAAiB;QAChD,0DAA0D;QAC1D,IAAI,CAAC,MAAM,OAAO;QAClB,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,OAAO;QACZ,OAAO,MAAM,sCAAsC;IACvD;AACJ;AAEA,eAAe;IACX,MAAM,iBAAiB,IAAI,OAAO,WAAW;IAC7C,MAAM,aAA0B;QAAE;IAAe;IACjD,MAAM,yGAAE,CAAC,SAAS,CAAC,iBAAiB,KAAK,SAAS,CAAC,YAAY,MAAM,IAAI;IACzE,OAAO;AACX;AAEO,eAAe;IAClB,IAAI,UAAU,MAAM;IAEpB,IAAI,CAAC,SAAS;QACV,UAAU,MAAM;IACpB;IAEA,MAAM,YAAY,IAAA,oJAAQ,EAAC,QAAQ,cAAc;IACjD,MAAM,MAAM,IAAI;IAChB,MAAM,aAAa,IAAA,kJAAO,EAAC,WAAW;IACtC,MAAM,gBAAgB,IAAA,oKAAgB,EAAC,YAAY;IAEnD,MAAM,WAAW,iBAAiB;IAElC,OAAO;QACH;QACA,SAAS;QACT,eAAe,KAAK,GAAG,CAAC,GAAG;QAC3B,YAAY,IAAA,gKAAM,EAAC,YAAY;IACnC;AACJ;;;IApBsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/currency/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport { z } from 'zod';\nimport { revalidatePath } from 'next/cache';\n\nexport type CurrencySettings = {\n    currencyCode: string;\n};\n\nconst settingsFilePath = path.join(process.cwd(), 'src/app/admin/currency/settings.json');\n\nconst defaultSettings: CurrencySettings = {\n    currencyCode: 'AED'\n};\n\nexport async function getCurrencySettings(): Promise<CurrencySettings> {\n    try {\n        await fs.access(settingsFilePath);\n        const data = await fs.readFile(settingsFilePath, 'utf-8');\n        return { ...defaultSettings, ...JSON.parse(data) };\n    } catch (error) {\n        if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n            return defaultSettings;\n        }\n        throw error;\n    }\n}\n\nconst currencySettingsSchema = z.object({\n    currencyCode: z.string().length(3, \"Currency code must be 3 characters long.\").toUpperCase(),\n});\n\nexport async function saveCurrencySettings(data: CurrencySettings) {\n    const validation = currencySettingsSchema.safeParse(data);\n\n    if (!validation.success) {\n        return { success: false, error: validation.error.errors[0].message };\n    }\n\n    try {\n        await fs.writeFile(settingsFilePath, JSON.stringify(validation.data, null, 2), 'utf-8');\n        revalidatePath('/', 'layout'); // Revalidate all pages\n        return { success: true };\n    } catch (error) {\n        console.error('Failed to save currency settings:', error);\n        return { success: false, error: 'Failed to save settings.' };\n    }\n}\n"],"names":[],"mappings":";;;;;;;AAGA;AACA;AACA;AACA;;;;;;;AAMA,MAAM,mBAAmB,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAElD,MAAM,kBAAoC;IACtC,cAAc;AAClB;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,yGAAE,CAAC,MAAM,CAAC;QAChB,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,kBAAkB;QACjD,OAAO;YAAE,GAAG,eAAe;YAAE,GAAG,KAAK,KAAK,CAAC,KAAK;QAAC;IACrD,EAAE,OAAO,OAAO;QACZ,IAAI,AAAC,MAAgC,IAAI,KAAK,UAAU;YACpD,OAAO;QACX;QACA,MAAM;IACV;AACJ;AAEA,MAAM,yBAAyB,uKAAC,CAAC,MAAM,CAAC;IACpC,cAAc,uKAAC,CAAC,MAAM,GAAG,MAAM,CAAC,GAAG,4CAA4C,WAAW;AAC9F;AAEO,eAAe,qBAAqB,IAAsB;IAC7D,MAAM,aAAa,uBAAuB,SAAS,CAAC;IAEpD,IAAI,CAAC,WAAW,OAAO,EAAE;QACrB,OAAO;YAAE,SAAS;YAAO,OAAO,WAAW,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO;QAAC;IACvE;IAEA,IAAI;QACA,MAAM,yGAAE,CAAC,SAAS,CAAC,kBAAkB,KAAK,SAAS,CAAC,WAAW,IAAI,EAAE,MAAM,IAAI;QAC/E,IAAA,+IAAc,EAAC,KAAK,WAAW,uBAAuB;QACtD,OAAO;YAAE,SAAS;QAAK;IAC3B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO;YAAE,SAAS;YAAO,OAAO;QAA2B;IAC/D;AACJ;;;IAhCsB;IAiBA;;AAjBA,+OAAA;AAiBA,+OAAA","debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/access-control/permissions.ts"],"sourcesContent":["\nexport type PermissionAction = {\n  action: string;\n  description: string;\n  allowedRoles: string[];\n};\n\nexport type FeaturePermission = {\n  feature: string;\n  description: string;\n  actions: PermissionAction[];\n};\n\nexport const featurePermissions: FeaturePermission[] = [\n  {\n    feature: 'Properties',\n    description: 'Manage property listings, details, and associated units/rooms.',\n    actions: [\n      { action: 'view', description: 'View property list and details', allowedRoles: ['Super Admin', 'Admin', 'Property Manager', 'Accountant', 'User'] },\n      { action: 'edit', description: 'Edit property information', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'delete', description: 'Delete a property', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'Units',\n    description: 'Manage individual units within a property.',\n    actions: [\n      { action: 'view', description: 'View unit list and details', allowedRoles: ['Super Admin', 'Admin', 'Property Manager', 'Accountant', 'User'] },\n      { action: 'edit', description: 'Edit unit information', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'delete', description: 'Delete a unit', allowedRoles: ['Super Admin'] },\n    ],\n  },\n   {\n    feature: 'Rent-A-Car',\n    description: 'Manage vehicle rental agreements.',\n    actions: [\n      { action: 'view', description: 'View rental agreements', allowedRoles: ['Super Admin', 'Admin', 'User'] },\n      { action: 'manage', description: 'Add/Edit/Delete rental agreements', allowedRoles: ['Super Admin', 'Admin'] },\n    ],\n  },\n   {\n    feature: 'Car Sales',\n    description: 'Manage vehicle buying and selling operations.',\n    actions: [\n      { action: 'view', description: 'View vehicle inventory and sales', allowedRoles: ['Super Admin', 'Admin', 'User'] },\n      { action: 'manage', description: 'Add, edit, and delete vehicle records', allowedRoles: ['Super Admin', 'Admin'] },\n    ],\n  },\n  {\n    feature: 'Lease Contracts',\n    description: 'Manage lease agreements with landlords.',\n    actions: [\n      { action: 'view', description: 'View lease agreements', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'manage', description: 'Create, edit, and delete lease agreements', allowedRoles: ['Super Admin', 'Admin'] },\n    ]\n  },\n  {\n    feature: 'Project Management',\n    description: 'Manage all aspects of projects, including billing, sub-contractors, and resource allocation.',\n    actions: [\n      { action: 'view', description: 'View project list and details', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'manage', description: 'Create, edit, and delete projects', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'manage_billing', description: 'Manage project progress billing and retention', allowedRoles: ['Super Admin', 'Accountant'] },\n    ],\n  },\n   {\n    feature: 'Vaults & Stores',\n    description: 'Manage inventory, stock levels, and store locations.',\n    actions: [\n      { action: 'view', description: 'View stores and stock levels', allowedRoles: ['Super Admin', 'Admin', 'User'] },\n      { action: 'manage', description: 'Add/Edit/Delete stores and manage stock transactions', allowedRoles: ['Super Admin', 'Admin'] },\n    ],\n  },\n    {\n    feature: 'Products & Services',\n    description: 'Manage the catalog of products and services offered.',\n    actions: [\n      { action: 'view', description: 'View products and services', allowedRoles: ['Super Admin', 'Admin', 'User'] },\n      { action: 'manage', description: 'Add/Edit/Delete products and services', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'view_pricing', description: 'View cost and sale prices', allowedRoles: ['Super Admin', 'Admin', 'Accountant'] },\n    ],\n  },\n  {\n    feature: 'Asset Management',\n    description: 'Manage company assets, depreciation, and assignments.',\n    actions: [\n      { action: 'view', description: 'View asset list', allowedRoles: ['Super Admin', 'Admin', 'Accountant'] },\n      { action: 'manage', description: 'Add, edit, and assign assets', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'delete', description: 'Delete assets from the register', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'Maintenance',\n    description: 'Manage maintenance tickets and service contracts.',\n    actions: [\n      { action: 'view_tickets', description: 'View maintenance tickets', allowedRoles: ['Super Admin', 'Admin', 'User'] },\n      { action: 'manage_tickets', description: 'Create, edit, and update tickets', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'view_contracts', description: 'View service contracts', allowedRoles: ['Super Admin', 'Admin', 'Accountant'] },\n      { action: 'manage_contracts', description: 'Manage service contracts', allowedRoles: ['Super Admin', 'Admin'] },\n    ],\n  },\n  {\n    feature: 'Workflow',\n    description: 'Manage document approval workflows.',\n    actions: [\n      { action: 'view', description: 'View workflow queue', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'manage', description: 'Approve or reject transactions', allowedRoles: ['Super Admin', 'Admin'] },\n    ],\n  },\n  {\n    feature: 'Data Processing',\n    description: 'Extract data from documents using AI.',\n    actions: [\n      { action: 'access', description: 'Access document processing and data extraction features', allowedRoles: ['Super Admin', 'Admin', 'User'] },\n    ],\n  },\n   {\n    feature: 'Utilities',\n    description: 'Manage utility accounts and bill payments.',\n    actions: [\n      { action: 'view', description: 'View utility accounts', allowedRoles: ['Super Admin', 'Admin', 'Accountant', 'User'] },\n      { action: 'manage', description: 'Add, edit, and delete utility accounts', allowedRoles: ['Super Admin', 'Admin'] },\n    ],\n  },\n  {\n    feature: 'Landlords',\n    description: 'Manage landlord profiles and their associated contracts.',\n    actions: [\n      { action: 'view', description: 'View landlord list and details', allowedRoles: ['Super Admin', 'Admin', 'Property Manager', 'Accountant'] },\n      { action: 'edit', description: 'Edit landlord information', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'delete', description: 'Delete a landlord', allowedRoles: ['Super Admin'] },\n    ],\n  },\n    {\n    feature: 'Vendors',\n    description: 'Manage supplier and vendor profiles.',\n    actions: [\n      { action: 'view', description: 'View vendor list and details', allowedRoles: ['Super Admin', 'Admin', 'Property Manager', 'Accountant', 'User'] },\n      { action: 'edit', description: 'Edit vendor information', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'delete', description: 'Delete a vendor', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'Tenants',\n    description: 'Manage tenant profiles and their tenancy contracts.',\n    actions: [\n      { action: 'view', description: 'View tenant list and details', allowedRoles: ['Super Admin', 'Admin', 'Property Manager', 'Accountant', 'User'] },\n      { action: 'edit', description: 'Edit tenant information', allowedRoles: ['Super Admin', 'Admin', 'Property Manager'] },\n      { action: 'delete', description: 'Delete a tenant', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'Customers',\n    description: 'Manage general customers for non-rental services.',\n    actions: [\n      { action: 'view', description: 'View customer list and details', allowedRoles: ['Super Admin', 'Admin', 'Accountant', 'User'] },\n      { action: 'edit', description: 'Edit customer information', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'delete', description: 'Delete a customer', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'Finance',\n    description: 'Access to financial modules like banking, payments, and chart of accounts.',\n    actions: [\n      { action: 'view_banking', description: 'View Banking and Petty Cash', allowedRoles: ['Super Admin', 'Admin', 'Accountant'] },\n      { action: 'manage_banking', description: 'Add/Edit/Delete bank accounts', allowedRoles: ['Super Admin'] },\n      { action: 'view_payments', description: 'View payment and receipt history', allowedRoles: ['Super Admin', 'Admin', 'Accountant'] },\n      { action: 'record_payment', description: 'Record new payments or receipts', allowedRoles: ['Super Admin', 'Admin', 'Accountant'] },\n      { action: 'delete_payment', description: 'Delete financial transactions', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'User Management',\n    description: 'Control over user accounts and their roles.',\n    actions: [\n      { action: 'view', description: 'View user list', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'add_user', description: 'Add new users', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'edit_user', description: 'Edit user details and roles', allowedRoles: ['Super Admin', 'Admin'] },\n      { action: 'delete_user', description: 'Delete a user', allowedRoles: ['Super Admin'] },\n    ],\n  },\n  {\n    feature: 'Settings',\n    description: 'Access to administrative settings.',\n    actions: [\n        { action: 'access_control', description: 'Manage user roles and permissions', allowedRoles: ['Super Admin'] },\n        { action: 'communication', description: 'Manage communication (Email/SMS) settings', allowedRoles: ['Super Admin', 'Admin'] },\n        { action: 'backup', description: 'Manage data backup and restore', allowedRoles: ['Super Admin'] },\n        { action: 'external_storage', description: 'Configure external storage (e.g., Google Drive)', allowedRoles: ['Developer'] },\n        { action: 'notifications', description: 'Send system-wide notifications', allowedRoles: ['Super Admin', 'Admin'] },\n        { action: 'contract_continuity', description: 'Review and fix contract data issues', allowedRoles: ['Super Admin'] },\n    ]\n  }\n];\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 764, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/access-control/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport { revalidatePath } from 'next/cache';\nimport { type FeaturePermission, featurePermissions } from './permissions';\nimport { type UserRole } from '../user-roles/schema';\nimport { type ModuleSettings } from './schema';\n\nconst permissionsFilePath = path.join(process.cwd(), 'src/app/admin/access-control/permissions.json');\nconst usersFilePath = path.join(process.cwd(), 'src/app/admin/user-roles/users.json');\nconst moduleSettingsFilePath = path.join(process.cwd(), 'src/app/admin/access-control/module-settings.json');\nconst userOverridesFilePath = path.join(process.cwd(), 'src/app/admin/access-control/user-overrides.json');\n\nasync function readData(filePath: string) {\n    try {\n        await fs.access(filePath);\n        const data = await fs.readFile(filePath, 'utf-8');\n        return JSON.parse(data);\n    } catch (error) {\n        if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n            // Return a default structure that can be safely merged\n            if (filePath.endsWith('permissions.json')) return [];\n            if (filePath.endsWith('users.json')) return [];\n            if (filePath.endsWith('module-settings.json')) return { modules: [] }; \n            if (filePath.endsWith('user-overrides.json')) return [];\n            return [];\n        }\n        throw error;\n    }\n}\n\nexport async function getPermissions(): Promise<FeaturePermission[]> {\n     const savedPermissions = await readData(permissionsFilePath);\n     // Merge saved permissions with the default structure to ensure all features are listed\n    const allPermissions = featurePermissions.map(feature => {\n        const savedFeature = savedPermissions.find((p: any) => p.feature === feature.feature);\n        const actions = feature.actions.map(action => {\n        const savedAction = savedFeature?.actions.find((a: any) => a.action === action.action);\n        return {\n            ...action,\n            allowedRoles: savedAction ? savedAction.allowedRoles : action.allowedRoles,\n        };\n        });\n        return {\n        ...feature,\n        actions,\n        };\n    });\n    return allPermissions;\n}\n\nexport async function savePermissions(permissions: FeaturePermission[]) {\n    try {\n        await fs.writeFile(permissionsFilePath, JSON.stringify(permissions, null, 2), 'utf-8');\n        revalidatePath('/admin/access-control');\n        return { success: true };\n    } catch (error) {\n        console.error('Failed to save permissions:', error);\n        return { success: false, error: 'Failed to save permissions.' };\n    }\n}\n\nexport async function updatePermission(featureName: string, actionName: string, role: string, isChecked: boolean) {\n    const currentPermissions = await getPermissions();\n    const feature = currentPermissions.find(f => f.feature === featureName);\n    if (feature) {\n        const action = feature.actions.find(a => a.action === actionName);\n        if (action) {\n            if (isChecked) {\n                if (!action.allowedRoles.includes(role)) {\n                    action.allowedRoles.push(role);\n                }\n            } else {\n                action.allowedRoles = action.allowedRoles.filter(r => r !== role);\n            }\n        }\n    }\n    return await savePermissions(currentPermissions);\n}\n\n\nexport async function getRoles(): Promise<string[]> {\n    try {\n        const users: UserRole[] = await readData(usersFilePath);\n        const allRoles = users.map(u => u.role);\n        // Add default roles that might not be in use yet\n        const defaultRoles = ['Super Admin', 'Admin', 'Property Manager', 'Accountant', 'User', 'Developer'];\n        const uniqueRoles = Array.from(new Set([...allRoles, ...defaultRoles]));\n        return uniqueRoles;\n    } catch (error) {\n        console.error(\"Failed to read user roles\", error);\n        return ['Super Admin', 'Admin', 'Property Manager', 'Accountant', 'User', 'Developer'];\n    }\n}\n\nexport type UserOverride = {\n    email: string;\n    allowedModules: string[];\n}\n\nexport async function getUserOverrides(): Promise<UserOverride[]> {\n    return (await readData(userOverridesFilePath)) as UserOverride[];\n}\n\nexport async function saveUserOverrides(overrides: UserOverride[]) {\n     try {\n        await fs.writeFile(userOverridesFilePath, JSON.stringify(overrides, null, 2), 'utf-8');\n        revalidatePath('/', 'layout');\n        return { success: true };\n    } catch (error) {\n        console.error('Failed to save user overrides:', error);\n        return { success: false, error: 'Failed to save user overrides.' };\n    }\n}\n\n\nexport async function getCombinedAccessControlData() {\n    try {\n        const [permissions, moduleSettings, userOverrides] = await Promise.all([\n            getPermissions(),\n            readData(moduleSettingsFilePath) as Promise<ModuleSettings>,\n            getUserOverrides()\n        ]);\n        return { success: true, permissions, moduleSettings, userOverrides };\n    } catch(error) {\n        return { success: false, error: (error as Error).message };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 960, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase/admin-config.ts"],"sourcesContent":["\nimport * as admin from 'firebase-admin';\nimport { existsSync } from 'fs';\n\nconst projectId = process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID;\n\n// The recommended approach is to use Application Default Credentials (ADC).\n// Initialize without any arguments and it will automatically use ADC if available.\ntry {\n    if (!admin.apps.length) {\n        console.log(\"Attempting to initialize Firebase Admin with Application Default Credentials...\");\n        admin.initializeApp({ projectId });\n        console.log(\"Firebase Admin initialized successfully with Application Default Credentials.\");\n    }\n} catch (e) {\n    console.warn(\"Could not initialize with Application Default Credentials, trying service account path.\", e);\n    \n    // Fallback for local development outside of a GCP environment\n    const serviceAccountPath = process.env.SERVICE_ACCOUNT_JSON_PATH;\n\n    if (!serviceAccountPath) {\n        throw new Error(\n            'Firebase initialization failed. Application Default Credentials not found. ' +\n            'For local development, set the SERVICE_ACCOUNT_JSON_PATH environment variable to the path of your service account JSON file in your .env.local'\n        );\n    }\n\n    if (!existsSync(serviceAccountPath)) {\n        throw new Error(\n            `Firebase initialization failed. Service account file not found at path: ${serviceAccountPath}. ` +\n            'Please check the SERVICE_ACCOUNT_JSON_PATH in your .env.local file.'\n        );\n    }\n    \n    if (!admin.apps.length) {\n        console.log(`Attempting to initialize Firebase Admin with service account file: ${serviceAccountPath}`);\n        admin.initializeApp({\n            credential: admin.credential.cert(serviceAccountPath),\n            projectId: projectId,\n        });\n        console.log(\"Firebase Admin initialized successfully with service account file.\");\n    }\n}\n\nconst firestoreAdmin = admin.firestore();\n\nexport { firestoreAdmin };\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEA,MAAM;AAEN,4EAA4E;AAC5E,mFAAmF;AACnF,IAAI;IACA,IAAI,CAAC,mIAAU,CAAC,MAAM,EAAE;QACpB,QAAQ,GAAG,CAAC;QACZ,4IAAmB,CAAC;YAAE;QAAU;QAChC,QAAQ,GAAG,CAAC;IAChB;AACJ,EAAE,OAAO,GAAG;IACR,QAAQ,IAAI,CAAC,2FAA2F;IAExG,8DAA8D;IAC9D,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,oBAAoB;QACrB,MAAM,IAAI,MACN,gFACA;IAER;IAEA,IAAI,CAAC,IAAA,2GAAU,EAAC,qBAAqB;QACjC,MAAM,IAAI,MACN,CAAC,wEAAwE,EAAE,mBAAmB,EAAE,CAAC,GACjG;IAER;IAEA,IAAI,CAAC,mIAAU,CAAC,MAAM,EAAE;QACpB,QAAQ,GAAG,CAAC,CAAC,mEAAmE,EAAE,oBAAoB;QACtG,4IAAmB,CAAC;YAChB,YAAY,yIAAgB,CAAC,IAAI,CAAC;YAClC,WAAW;QACf;QACA,QAAQ,GAAG,CAAC;IAChB;AACJ;AAEA,MAAM,iBAAiB,wIAAe","debugId":null}},
    {"offset": {"line": 1004, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { firestoreAdmin } from '@/lib/firebase/admin-config';\nimport { type Unit } from '@/app/property/units/schema';\nimport { type Contract } from '@/app/tenancy/contract/schema';\nimport { type Room } from '../rooms/schema';\n\nasync function getProperties() {\n    const propertiesCollection = firestoreAdmin.collection('properties');\n    const snapshot = await propertiesCollection.get();\n    return snapshot.docs.map(doc => doc.data());\n}\n\nasync function writeProperties(data: any) {\n    const propertiesCollection = firestoreAdmin.collection('properties');\n    for (const property of data) {\n        await propertiesCollection.doc(property.id).set(property);\n    }\n}\n\nexport async function savePropertyData(dataToSave: any, isNewRecord: boolean) {\n    try {\n        const allProperties:any = await getProperties();\n\n        if (isNewRecord) {\n            const propertyExists = allProperties.some((p: any) => (p.propertyData ? p.propertyData.code : p.code) === dataToSave.propertyData.code);\n            if (propertyExists) {\n                return { success: false, error: `Property with code \"${dataToSave.propertyData.code}\" already exists.` };\n            }\n            const newProperty = {\n                id: `PROP-${Date.now()}`,\n                ...dataToSave\n            };\n            await firestoreAdmin.collection('properties').doc(newProperty.id).set(newProperty);\n        } else {\n            const property = allProperties.find((p: any) => {\n                const code = p.propertyData ? p.propertyData.code : p.code;\n                return code === dataToSave.propertyData.code;\n            });\n\n            if (property) {\n                const updatedProperty = {\n                    ...property,\n                    ...dataToSave,\n                    id: property.id\n                };\n                await firestoreAdmin.collection('properties').doc(property.id).set(updatedProperty);\n            } else {\n                const newProperty = {\n                    id: `PROP-${Date.now()}`,\n                    ...dataToSave,\n                };\n                await firestoreAdmin.collection('properties').doc(newProperty.id).set(newProperty);\n            }\n        }\n\n        return { success: true };\n    } catch (error) {\n        console.error('Failed to save property data:', error);\n        return { success: false, error: (error as Error).message || 'An unknown error occurred' };\n    }\n}\n\nexport async function findPropertyData(propertyCode: string) {\n    try {\n        const propertiesCollection = firestoreAdmin.collection('properties');\n        const snapshot = await propertiesCollection.where('propertyData.code', '==', propertyCode).get();\n        \n        if (snapshot.empty) {\n            return { success: false, error: \"Not Found\" };\n        }\n\n        return { success: true, data: snapshot.docs[0].data() };\n    } catch (error) {\n        console.error('Failed to find property data:', error);\n        return { success: false, error: (error as Error).message || 'An unknown error occurred' };\n    }\n}\n\nexport async function deletePropertyData(propertyCode: string) {\n    try {\n        const propertiesCollection = firestoreAdmin.collection('properties');\n        const snapshot = await propertiesCollection.where('propertyData.code', '==', propertyCode).get();\n\n        if (snapshot.empty) {\n            return { success: false, error: 'Property not found.' };\n        }\n\n        const docId = snapshot.docs[0].id;\n        await propertiesCollection.doc(docId).delete();\n\n        return { success: true };\n    } catch (error) {\n        console.error('Failed to delete property data:', error);\n        return { success: false, error: (error as Error).message || 'An unknown error occurred' };\n    }\n}\n\nexport async function getOccupancyInfoForProperty(propertyCode: string) {\n    try {\n        const contractsCollection = firestoreAdmin.collection('contracts');\n        const snapshot = await contractsCollection.where('property', '==', propertyCode).get();\n        const occupancyInfo = snapshot.docs.map(doc => {\n            const data = doc.data();\n            return {\n                unitCode: data.unitCode,\n                tenantName: data.tenantName,\n                contractId: data.id,\n            };\n        });\n\n        return { success: true, data: occupancyInfo };\n    } catch (error) {\n        console.error('Failed to get occupancy info:', error);\n        return { success: false, error: (error as Error).message || 'An unknown error occurred' };\n    }\n}\n\nasync function readUnits(): Promise<Unit[]> {\n    const unitsCollection = firestoreAdmin.collection('units');\n    const snapshot = await unitsCollection.get();\n    return snapshot.docs.map(doc => doc.data() as Unit);\n}\n\nasync function readRooms(): Promise<Room[]> {\n    const roomsCollection = firestoreAdmin.collection('rooms');\n    const snapshot = await roomsCollection.get();\n    return snapshot.docs.map(doc => doc.data() as Room);\n}\n\n\nexport async function getUnitsForProperty(propertyCode: string): Promise<{ success: boolean, data?: Unit[], error?: string }> {\n    try {\n        const allUnits = await readUnits();\n        const allRooms = await readRooms();\n        const contractsCollection = firestoreAdmin.collection('contracts');\n        const contractsSnapshot = await contractsCollection.get();\n        const allContracts: Contract[] = contractsSnapshot.docs.map(doc => doc.data() as Contract);\n\n        const activeContracts = allContracts.filter(c => c.status === 'New' || c.status === 'Renew');\n        \n        const unitLevelContractCodes = new Set(activeContracts.filter(c => !c.roomCode && c.unitCode).map(c => c.unitCode));\n        const occupiedRoomCodes = new Set(activeContracts.filter(c => c.roomCode).map(c => c.roomCode));\n\n        const propertyUnits = allUnits\n            .filter(u => u.propertyCode === propertyCode)\n            .map(unit => {\n                let occupancyStatus: 'Vacant' | 'Occupied' | 'Partially Occupied' = 'Vacant';\n\n                if (unitLevelContractCodes.has(unit.unitCode)) {\n                    occupancyStatus = 'Occupied';\n                } else {\n                    const roomsInUnit = allRooms.filter(r => r.propertyCode === unit.propertyCode && r.unitCode === unit.unitCode);\n                    if (roomsInUnit.length > 0) {\n                        const occupiedRoomsCount = roomsInUnit.filter(r => occupiedRoomCodes.has(r.roomCode)).length;\n\n                        if (occupiedRoomsCount === 0) {\n                            occupancyStatus = 'Vacant';\n                        } else if (occupiedRoomsCount < roomsInUnit.length) {\n                            occupancyStatus = 'Partially Occupied';\n                        } else {\n                            occupancyStatus = 'Occupied';\n                        }\n                    } else {\n                        occupancyStatus = 'Vacant';\n                    }\n                }\n                \n                return {\n                    ...unit,\n                    occupancyStatus,\n                };\n            });\n            \n        return { success: true, data: propertyUnits };\n    } catch (error) {\n        console.error('Failed to get units for property:', error);\n        return { success: false, error: (error as Error).message || 'An unknown error occurred' };\n    }\n}\n\nasync function readLandlords() {\n    const landlordsCollection = firestoreAdmin.collection('landlords');\n    const snapshot = await landlordsCollection.get();\n    return snapshot.docs.map(doc => doc.data());\n}\n\nexport async function getPropertyLookups() {\n    const landlords:any = await readLandlords();\n    return {\n        landlords: landlords.map((l: any) => ({ code: l.landlordData.code, name: l.landlordData.name })),\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1239, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/property/properties/list/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getCompanyProfile as '00b6be478acfdf6b7794a7b34be547b3606ebfd51c'} from 'ACTIONS_MODULE0'\nexport {saveCompanyProfile as '40c9350172a0cc49767c134a7e5ed44affe0683337'} from 'ACTIONS_MODULE0'\nexport {checkLicenseStatus as '008a29e84bd260b304f797613c7c39c01029f96950'} from 'ACTIONS_MODULE1'\nexport {getCurrencySettings as '00bf02fbdbf2069a58be66f4c215b7083c555f2e0f'} from 'ACTIONS_MODULE2'\nexport {getCombinedAccessControlData as '00484ec9aa59cb806ed9f49233b1daa442fefc4db8'} from 'ACTIONS_MODULE3'\nexport {deletePropertyData as '40a4ac21220d436bb11dd0571f9145571b903583b9'} from 'ACTIONS_MODULE4'\n"],"names":[],"mappings":";AAAA;AAEA;AACA;AACA;AACA","debugId":null}},
    {"offset": {"line": 1287, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/list/columns.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const columns = registerClientReference(\n    function() { throw new Error(\"Attempted to call columns() from the server but columns is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/property/properties/list/columns.tsx <module evaluation>\",\n    \"columns\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,UAAU,IAAA,wQAAuB,EAC1C;IAAa,MAAM,IAAI,MAAM;AAA8N,GAC3P,8EACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1301, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/list/columns.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const columns = registerClientReference(\n    function() { throw new Error(\"Attempted to call columns() from the server but columns is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/property/properties/list/columns.tsx\",\n    \"columns\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,UAAU,IAAA,wQAAuB,EAC1C;IAAa,MAAM,IAAI,MAAM;AAA8N,GAC3P,0DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1315, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 1323, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/list/data-table.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DataTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call DataTable() from the server but DataTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/property/properties/list/data-table.tsx <module evaluation>\",\n    \"DataTable\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,YAAY,IAAA,wQAAuB,EAC5C;IAAa,MAAM,IAAI,MAAM;AAAkO,GAC/P,iFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1337, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/list/data-table.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DataTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call DataTable() from the server but DataTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/property/properties/list/data-table.tsx\",\n    \"DataTable\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,YAAY,IAAA,wQAAuB,EAC5C;IAAa,MAAM,IAAI,MAAM;AAAkO,GAC/P,6DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1351, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 1359, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/list/schema.ts"],"sourcesContent":["\nimport { z } from 'zod';\n\nexport const attachmentSchema = z.object({\n  id: z.number(),\n  name: z.string(),\n  file: z.string().nullable(),\n  remarks: z.string(),\n  isLink: z.boolean()\n});\n\nexport const propertySchema = z.object({\n  id: z.string(),\n  code: z.string(),\n  name: z.string(),\n  propertyType: z.string(),\n  status: z.string(),\n  noOfUnits: z.string(),\n  attachments: z.array(attachmentSchema).optional(),\n  landlordCode: z.string().optional(),\n  landlord: z.string().optional(),\n});\n\nexport type Property = z.infer<typeof propertySchema>;\n"],"names":[],"mappings":";;;;;;AACA;;AAEO,MAAM,mBAAmB,uKAAC,CAAC,MAAM,CAAC;IACvC,IAAI,uKAAC,CAAC,MAAM;IACZ,MAAM,uKAAC,CAAC,MAAM;IACd,MAAM,uKAAC,CAAC,MAAM,GAAG,QAAQ;IACzB,SAAS,uKAAC,CAAC,MAAM;IACjB,QAAQ,uKAAC,CAAC,OAAO;AACnB;AAEO,MAAM,iBAAiB,uKAAC,CAAC,MAAM,CAAC;IACrC,IAAI,uKAAC,CAAC,MAAM;IACZ,MAAM,uKAAC,CAAC,MAAM;IACd,MAAM,uKAAC,CAAC,MAAM;IACd,cAAc,uKAAC,CAAC,MAAM;IACtB,QAAQ,uKAAC,CAAC,MAAM;IAChB,WAAW,uKAAC,CAAC,MAAM;IACnB,aAAa,uKAAC,CAAC,KAAK,CAAC,kBAAkB,QAAQ;IAC/C,cAAc,uKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,UAAU,uKAAC,CAAC,MAAM,GAAG,QAAQ;AAC/B","debugId":null}},
    {"offset": {"line": 1389, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB","debugId":null}},
    {"offset": {"line": 1404, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/button.tsx"],"sourcesContent":["\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground\",\n        destructive:\n          \"bg-destructive text-destructive-foreground\",\n        outline:\n          \"border border-input bg-background\",\n        secondary:\n          \"bg-secondary text-secondary-foreground\",\n        ghost: \"\",\n        link: \"text-primary underline-offset-4\",\n        \"sidebar-accent\": \"bg-sidebar-accent text-sidebar-accent-foreground\"\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,4VACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;YACN,kBAAkB;QACpB;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,mNAAgB,CAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,IAAA,yHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1465, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/property/properties/list/page.tsx"],"sourcesContent":["\n\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport { z } from 'zod';\nimport Link from 'next/link';\n\nimport { columns } from './columns';\nimport { DataTable } from './data-table';\nimport { propertySchema } from './schema';\nimport { Button } from '@/components/ui/button';\nimport { Plus } from 'lucide-react';\n\nconst propertiesListSchema = z.array(propertySchema);\n\nasync function getLandlords() {\n    try {\n        const data = await fs.readFile(\n            path.join(process.cwd(), 'src/app/landlord/landlords-data.json')\n        );\n        return JSON.parse(data.toString());\n    } catch (error) {\n        if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n            return [];\n        }\n        throw error;\n    }\n}\n\nasync function getProperties() {\n  const propertiesData = await fs.readFile(\n    path.join(process.cwd(), 'src/app/property/properties/list/properties-data.json')\n  );\n  const properties = JSON.parse(propertiesData.toString());\n  \n  const landlords = await getLandlords();\n  const landlordMap = new Map(landlords.map((l: any) => [l.landlordData.code, l.landlordData.name]));\n\n  const normalizedProperties = properties.map((p: any) => {\n    const baseProperty = p.propertyData ? p.propertyData : p;\n    return {\n      ...baseProperty,\n      id: p.id || baseProperty.id,\n      attachments: p.attachments || [],\n      landlord: baseProperty.landlordCode ? landlordMap.get(baseProperty.landlordCode) || 'N/A' : 'N/A',\n    };\n  });\n\n  return propertiesListSchema.parse(normalizedProperties);\n}\n\n\nexport default async function PropertiesPage() {\n  const properties = await getProperties();\n\n  return (\n    <div className=\"container mx-auto py-10\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-3xl font-bold font-headline\">Properties</h1>\n        <Button asChild>\n          <Link href=\"/property/properties/add\">\n            <Plus className=\"mr-2 h-4 w-4\" /> Add New Property\n          </Link>\n        </Button>\n      </div>\n      <DataTable columns={columns} data={properties} />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,uBAAuB,uKAAC,CAAC,KAAK,CAAC,wKAAc;AAEnD,eAAe;IACX,IAAI;QACA,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAC1B,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAE7B,OAAO,KAAK,KAAK,CAAC,KAAK,QAAQ;IACnC,EAAE,OAAO,OAAO;QACZ,IAAI,AAAC,MAAgC,IAAI,KAAK,UAAU;YACpD,OAAO,EAAE;QACb;QACA,MAAM;IACV;AACJ;AAEA,eAAe;IACb,MAAM,iBAAiB,MAAM,yGAAE,CAAC,QAAQ,CACtC,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;IAE3B,MAAM,aAAa,KAAK,KAAK,CAAC,eAAe,QAAQ;IAErD,MAAM,YAAY,MAAM;IACxB,MAAM,cAAc,IAAI,IAAI,UAAU,GAAG,CAAC,CAAC,IAAW;YAAC,EAAE,YAAY,CAAC,IAAI;YAAE,EAAE,YAAY,CAAC,IAAI;SAAC;IAEhG,MAAM,uBAAuB,WAAW,GAAG,CAAC,CAAC;QAC3C,MAAM,eAAe,EAAE,YAAY,GAAG,EAAE,YAAY,GAAG;QACvD,OAAO;YACL,GAAG,YAAY;YACf,IAAI,EAAE,EAAE,IAAI,aAAa,EAAE;YAC3B,aAAa,EAAE,WAAW,IAAI,EAAE;YAChC,UAAU,aAAa,YAAY,GAAG,YAAY,GAAG,CAAC,aAAa,YAAY,KAAK,QAAQ;QAC9F;IACF;IAEA,OAAO,qBAAqB,KAAK,CAAC;AACpC;AAGe,eAAe;IAC5B,MAAM,aAAa,MAAM;IAEzB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,8OAAC,4IAAM;wBAAC,OAAO;kCACb,cAAA,8OAAC,uKAAI;4BAAC,MAAK;;8CACT,8OAAC,0MAAI;oCAAC,WAAU;;;;;;gCAAiB;;;;;;;;;;;;;;;;;;0BAIvC,8OAAC,2KAAS;gBAAC,SAAS,mKAAO;gBAAE,MAAM;;;;;;;;;;;;AAGzC","debugId":null}}]
}